---
title: "오라클 스토리지"
categories: 
  - Oracle 10g
last_modified_at: 2019-07-22T11:25:00+09:00
toc: true
---

![Alt text](/assets/images/storage1.png  " ")
-------------
![Alt text](/assets/images/storage2.png  " ")
-------------

> 데이터베이스 하나에는 
> 하나 이상의 테이블스페이스들이 있다.

> 테이블스페이스 하나에는
> 하나 이상의 세그먼트들이 있다.

> 세그먼트 하나에는
> 하나 이상의 익스텐트들이 있다.

> 익스텐트 하나에는
> 하나 이상의 오라클 블록이 있다.

> 데이터 블록 하나에는
> 하나 이상의 OS 블록이 있다.

> OS 블록은 최소 단위 이다.

# 1. OS Block
* 운영체제의 I/O 단위이며 여러개가 모여 하나의 데이터 블럭을 구성, 오라클 스토리지에서 가장 작은 단위

# 2. Oracle Data Block
* Oracle Block, Data Block, Logical Block 또는 page라는 용어로 불려진다.
* OS Block을 한 개 이상 합쳐서 생성하게 된다.
* CREATE DATABASE 할 때 DB_BLOCK_SIZE로 파라미터로 지정이 된다. Database를 재 생성하기 전에는 변경할 수 없다.
* DB_BLOCK_SIZE 파라미터로 지정되는 크기 값을 Standard Block Size 라고 한다.
* 나머지를 Non-Standard Block Size 라고 한다.
* Block의 크기는 OS의 종류에 영향을 많이 받는다.
* 최소 2KB부터 4..8..16..32KB가 제공되며 64까지 지원하는 OS도 간혹 있다.
* Block의 크기가 클수록 I/O를 줄일 수 있지만 데이터가 적을 경우 공간이 낭비 될 수 있다.

## 2-1. Oracle Data Block 상세 구조 

![Alt text](/assets/images/DataBlockLayout.png  " ")

* Block Header 에는 Cache Layer와 Transaction Layer로 나뉘어져 있다.
* Cache Layer에는 아래와 같은 주요 정보가 들어가 있다.
  + Data Block Address (DBA)
  + Block Type (예: Table, Index, Undo)
  + Block Format (v6, v7, v8 ....)
  + System Change Number (SCN)   
* Transaction Layer에는 fixed 영역과 variable 영역이 있다.
* Fixed 영역은 v$type_size에서 KTBBH 영역에 행당된다.
* Fixed 영역에는
  + Block Type
  + 마지막으로 수행된 Block Cleanout 시간
  + ITL Enrties
  + Free List Link 정보
  + Free space Lock 정보
  등이 저장되어 있다.
* Variable 영역은 v$type_size에서 KTBIT 영역에 해당된다.
  + 해당 Block에 있는 Row를 변경하기를 원하는 실제 ITL 관련 정보가 들어가 있다.
  + ITL(Interested Transaction List)이란? Oracle에서 특정 Block에 데이터를 변경해야 할 경우 해당 Block에 사용자 명단에 (TxID 등)을 적고 변경을 해야 하는데
    현재 다른 사용자들이 그 Block을 수정하고 있어서 진입을 못한다면 대기자 명단에 자신의 정보를 적고 기다렸다가 자신의 순서가 될 때까지 기다려야 하는데
    이때 사용하는 대기자 명단을 ITL이라 한다.
  + 테이블에 대한 1개의 ITL과 인덱스에 대한 2개의 ITL 정보가 기본값으로 들어가 있다.
  + 테이블이나 인덱스를 생성할 때 INITRANS 파라미터이ㅡ 값을 변경하면 그 기본값을 변경할 수 있다.

# 3. Data Layer
* 실제 데이터가 저장된다.
* Table Index 항목의 내용과 Row Index 항목의 내용이 들어 있다.
* Free Space 정보를 관리한다. (실제 데이터를 저장되는 곳이라 Free Space 관리가 중요하다)
  + Row Index 에서 첫 번째 빈 공간의 포인터 주소와 빈 공간의 시작과 끝나는 Offset 주소, 사용 가능한 빈 공간의 양을 가지고 있다.















# 6. SEGMENT
## 6.1 Storage를 갖는 Object

## `
. 